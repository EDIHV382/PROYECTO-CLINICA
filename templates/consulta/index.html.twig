{% extends 'baseClinica.html.twig' %}
{% block title %}Historial de Consultas{% endblock %}

{% block body %}
<div id="notification-container" style="position: fixed; top: 85px; right: 1rem; z-index: 1056;"></div>
<div class="container py-5">
    <header class="card-grid-header">
        <div>
            <h2 class="card-grid-title">Historial de Consultas</h2>
            <p class="card-grid-subtitle">Selecciona un paciente para ver o a√±adir consultas a su historial.</p>
        </div>
    </header>

    <div class="card-grid-toolbar mb-4">
        <div class="search-input-group">
            <input type="text" id="buscador-pacientes" class="form-control" placeholder="Buscar paciente por nombre...">
            <span class="input-group-text"><i class="mdi mdi-magnify"></i></span>
        </div>
        {% if pacientes is defined and pacientes.getTotalItemCount > 0 %}
            <span class="text-muted fw-semibold d-none d-md-block">{{ pacientes.getTotalItemCount }} pacientes</span>
        {% endif %}
    </div>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 patient-card-grid">
        {% for paciente in pacientes %}
            <div class="col">
                <div class="patient-card" data-paciente-id="{{ paciente.id }}">
                    <div class="patient-avatar"><i class="mdi mdi-{{ paciente.sexo == 'M' ? 'face-man' : 'face-woman' }}"></i></div>
                    <h5 class="patient-name">{{ paciente.nombre }}</h5>
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="d-flex justify-content-center mt-5">
        {{ knp_pagination_render(pacientes) }}
    </div>
    
    <div id="historial-container" class="mt-5">
        <div class="text-center p-5 bg-light border rounded text-muted">
            <i class="mdi mdi-arrow-up-bold-box-outline mdi-48px"></i>
            <p class="mt-3">Selecciona un paciente de la lista de arriba para ver su historial.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block stylesheets %}
<style>
    .patient-card {
        background-color: var(--color-surface); border: 2px solid var(--color-border);
        border-radius: 1rem; padding: 1.5rem; text-align: center;
        height: 100%; cursor: pointer; transition: all 0.3s ease;
    }
    .patient-card:hover {
        transform: translateY(-5px); box-shadow: 0 8px 20px var(--shadow-md);
        border-color: var(--color-primary-light);
    }
    .patient-card.active {
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.3);
        transform: translateY(-5px);
    }
    .patient-avatar { font-size: 3rem; color: var(--color-primary); margin-bottom: 1rem; }
    .patient-name { font-size: 1.1rem; font-weight: 600; }
    #historial-container .main-content-card {
        border: 1px solid var(--color-border);
        border-radius: 1rem;
        box-shadow: 0 4px 20px var(--shadow-sm);
        overflow: hidden;
        background-color: var(--color-surface);
    }
    #historial-container .card-header {
        padding: 1.5rem 2rem;
    }
    #historial-container .command-table th {
        background-color: var(--color-background);
    }
    body.dark-mode #historial-container .command-table th {
        background-color: var(--color-surface);
    }
</style>
{% endblock %}